# Инструкция по развертыванию Django приложения

Этот документ описывает процесс развертывания Django приложения на сервере Ubuntu 24.04 с использованием Docker,
Gunicorn, Nginx, и MySQL.

## Общая информация

•   **Операционная система:** Ubuntu 24.04
•   **Веб-сервер:** Nginx
•   **Сервер приложений:** Gunicorn
•   **Контейнеризация:** Docker
•   **База данных:** MySQL
•   **SSL:** Let's Encrypt (бесплатный SSL-сертификат)

## Подготовка

1. **Установите Ubuntu 24.04:**
   • Установите Ubuntu 24.04 на ваш сервер.

2. **Получите доступ к серверу:**
   • Убедитесь, что вы можете подключаться к серверу через SSH.

3. **Подготовьте Python проект:**
   • Убедитесь, что у вас есть Django проект, готовый к развертыванию.
   • В корне вашего проекта должен быть файл `requirements.txt` с зависимостями.

4. **Подготовьте GitHub репозиторий:**
   • Убедитесь, что ваш проект хранится в репозитории на GitHub.

## Развертывание

1. **Скопируйте скрипт развертывания:**
   • Скопируйте скрипт `deploy.py` на ваш сервер.

2. **Измените параметры скрипта `deploy.py`:**
   • Откройте файл `deploy.py` и замените следующие плейсхолдеры на ваши значения:
    * `PROJECT_NAME`: Название вашего проекта.
    * `GITHUB_REPO`: URL вашего репозитория на GitHub.
    * `DOMAIN`: Ваш домен.
    * `EMAIL`: Ваш email для Let's Encrypt.
    * `DB_NAME`: Имя базы данных MySQL.
    * `DB_USER`: Имя пользователя базы данных MySQL.
    * `DB_PASSWORD`: Пароль пользователя базы данных MySQL.

• Скрипт выполнит следующие действия:

* Обновит систему и установит необходимые зависимости.
* Клонирует ваш проект из GitHub.
* Создаст виртуальное окружение и установит зависимости.
* Создаст базу данных MySQL и настроит пользователя.
* Создаст бесплатный SSL-сертификат от Let's Encrypt.
* Создаст конфигурацию Nginx для вашего домена.
* Создаст Dockerfile и docker-compose.yml.
* Соберет Docker образ.
* Запустит Docker контейнер с вашим приложением.
* Соберет статические файлы.
* Выполнит миграцию базы данных.
* Создаст systemd сервис и запустит его.

3. **Запустите скрипт `deploy.py`:**

# Структура сайта

Данный раздел описывает структуру веб-сайта для учета оборудования в нефтесервисной компании.

## Основные разделы

* **Главная страница (/)**
    * Обзорная информация о системе.
    * Краткая сводка по количеству оборудования и бригад.
    * Навигационные ссылки на другие разделы.

* **Аутентификация (/auth/)**
    * **Вход (/auth/login/)**
        * Форма для ввода логина и пароля.

* **Бригады (/brigades/)**
    * **Список бригад (/brigades/)**
        * Отображение списка всех бригад.
        * Возможность поиска и фильтрации.
        * Кнопка "Добавить бригаду".
    * **Детали бригады (/brigades/<id>/)**
        * Информация о конкретной бригаде.
        * Список оборудования, закрепленного за бригадой.
    * **Создание/редактирование бригады (/brigades/create/, /brigades/<id>/update/)**
        * Форма для добавления новой или редактирования существующей бригады.

* **Категории оборудования (/categories/)**
    * **Список категорий (/categories/)**
        * Отображение списка всех категорий оборудования.
        * Кнопка "Добавить категорию".
    * **Создание/редактирование категории (/categories/create/, /categories/<id>/update/)**
        * Форма для добавления новой или редактирования существующей категории.

* **Оборудование (/equipment/)**
    * **Список оборудования (/equipment/)**
        * Отображение списка всего оборудования.
        * Возможность поиска, фильтрации по категории и бригаде.
    * **Детали оборудования (/equipment/id/)**
        * Информация о конкретном оборудовании.
        * Возможность загрузки/просмотра/удаления документов.
    * **Создание/редактирование оборудования (/equipment/create/, /equipment/<id>/update/)**
        * Форма для добавления нового или редактирования существующего оборудования.

* **Перемещения оборудования (/transfers/)**
    * **Форма перемещения (/transfers/create/)**
        * Форма для перемещения оборудования между бригадами.
    * **История перемещений (/transfers/history/)**
    * Список всех перемещений оборудования.

* **Пользователи (/users/)**
    * **Список пользователей (/users/)**
        * Отображение списка всех пользователей.
        * Кнопка "Добавить пользователя".
    * **Создание/редактирование пользователя (/users/create/, /users/<id>/update/)**
        * Форма для добавления нового или редактирования существующего пользователя.

* **Отчеты (/reports/)**
    * **Список отчетов (/reports/)**
    * Список доступных отчетов
    * **Общий свод (/reports/summary/)**
        * Общая информация о количестве оборудования по всему предприятию.
    * **Свод по бригадам (/reports/brigades/)**
        * Информация о количестве оборудования по каждой бригаде.
        * Возможность выгрузки отчетов (например, в CSV).

templates/
├── 404.html

- Страница 404: Отображается, когда страница не найдена (ошибка 404).
  ├── 503.html
- Страница 503: Отображается, когда сервис временно недоступен (ошибка 503).
  ├── accounts
  │ ├── login.html
  │ - Форма входа: Страница для входа пользователей в систему.
  │ ├── mail_template.html
  │ - Шаблон электронного письма: Базовый шаблон для всех электронных писем, отправляемых системой.
  │ ├── password_change_done.html
  │ - Успешная смена пароля: Сообщение об успешной смене пароля.
  │ ├── password_change.html
  │ - Форма смены пароля: Страница для смены пароля пользователем.
  │ ├── password_reset_complete.html
  │ - Успешный сброс пароля: Сообщение об успешном сбросе пароля.
  │ ├── password_reset_confirm.html
  │ - Форма подтверждения сброса пароля: Страница для подтверждения сброса пароля через ссылку из email.
  │ ├── password_reset_done.html
  │ - Уведомление об отправке инструкции по сбросу пароля: Сообщение об отправке инструкции по сбросу пароля на email.
  │ ├── password_reset.html
  │ - Форма запроса на сброс пароля: Страница для запроса на сброс пароля пользователем.
  │ └── register.html
  │ - Форма регистрации: Страница для регистрации нового пользователя.
  ├── dashboard
  │ ├── brigades
  │ │ ├── brigade_detail.html
  │ │ - Детальная информация о бригаде: Страница с подробной информацией о выбранной бригаде.
  │ │ ├── brigade_form_create.html
  │ │ - Форма создания бригады: Страница с формой для создания новой бригады.
  │ │ ├── brigade_form_update.html
  │ │ - Форма обновления бригады: Страница с формой для обновления данных существующей бригады.
  │ │ ├── brigade_list.html
  │ │ - Список бригад: Страница со списком всех бригад.
  │ │ ├── brigade_search.html
  │ │ - Форма поиска бригад: Страница с формой для поиска бригад.
  │ │ └── _brigade_table.html
  │ │ - Таблица бригад: Частичный шаблон (fragment) для отображения таблицы бригад.
  │ ├── categories
  │ │ ├── category_form.html
  │ │ - Форма категории: Страница с формой для создания или обновления категории.
  │ │ └── category_list.html
  │ │ - Список категорий: Страница со списком всех категорий.
  │ ├── equipment
  │ │ ├── document_upload.html
  │ │ - Форма загрузки документа: Страница для загрузки документов, связанных с оборудованием.
  │ │ ├── equipment_add_documents.html
  │ │ - Страница для прикрепления документов к оборудованию: Позволяет прикреплять документы к определенной единице
  оборудования
  │ │ ├── equipment_detail.html
  │ │ - Детальная информация об оборудовании: Страница с подробной информацией о выбранной единице оборудования.
  │ │ ├── equipment_form_by_brigade.html
  │ │ - Форма добавления оборудования по бригаде: Страница с формой для добавления оборудования конкретной бригаде.
  │ │ ├── equipment_form.html
  │ │ - Форма добавления/редактирования оборудования: Страница с формой для создания или обновления единицы
  оборудования.
  │ │ ├── equipment_list.html
  │ │ - Список оборудования: Страница со списком всего оборудования.
  │ │ ├── _equipment_table.html
  │ │ - Таблица оборудования: Частичный шаблон (fragment) для отображения таблицы оборудования.
  │ │ ├── equipment_update_by_brigade.html
  │ │ - Форма обновления оборудования по бригаде: Страница с формой для обновления оборудования конкретной бригады.
  │ │ └── equipment_update.html
  │ │ - Форма обновления оборудования: Страница с формой для обновления единицы оборудования.
  │ ├── index.html
  │ - Главная страница панели управления: Основная страница панели управления после входа пользователя.
  │ ├── instruction.html
  │ - Инструкция: Страница с инструкцией для пользователей.
  │ ├── reports
  │ - (Заглушка) Страница отчетов: Зарезервированное место для страниц с отчетами.
  │ ├── transfers
  │ │ └── transfer_history.html
  │ │ - История перемещений оборудования: Страница, где отображается история пе
  ремещений оборудования.
  │ └── users
  │ ├── user_account_form.html
  │ - Форма редактирования профиля пользователя: Страница для редактирования личной информации пользователя.
  │ ├── user_action_log.html
  │ - Журнал действий пользователей: Страница со списком действий, выполненных пользователями системы.
  │ ├── _user_action_table.html
  │ - Таблица действий пользователя: Частичный шаблон (fragment) для отображения таблицы действий пользователей.
  │ ├── user_detail.html
  │ - Детальная информация о пользователе: Страница с подробной информацией о выбранном пользователе.
  │ ├── user_form.html
  │ - Форма добавления/редактирования пользователя: Страница с формой для создания или обновления пользователя.
  │ ├── user_list.html
  │ - Список пользователей: Страница со списком всех пользователей системы.
  │ └── _user_table.html
  │ - Таблица пользователей: Частичный шаблон (fragment) для отображения таблицы пользователей.
  ├── home
  │ └── index.html
  │ - Главная страница: Основная страница сайта, доступная до входа в систему.
  ├── includes
  │ ├── footer.html
  │ - Подвал сайта: Содержит общую информацию подвала сайта (например, копирайт).
  │ ├── form_errors.html
  │ - Вывод ошибок формы: Частичный шаблон для отображения ошибок, возникающих при отправке формы.
  │ ├── messages_error.html
  │ - Вывод ошибок: Частичный шаблон для отображения ошибок.
  │ ├── messages_success.html
  │ - Вывод сообщений об успехе: Частичный шаблон для отображения сообщений об успехе.
  │ ├── navigation.html
  │ - Навигационное меню: Частичный шаблон для навигационного меню сайта.
  │ ├── pagination.html
  │ - Пагинация: Частичный шаблон для пагинации (разбиения на страницы) больших списков данных.
  │ ├── scripts.html
  │ - Подключение скриптов: Содержит подключения общих JavaScript-файлов.
  │ ├── search.html
  │ - Форма поиска: Частичный шаблон для формы поиска.
  │ └── sidebar.html
  │ - Боковая панель: Частичный шаблон для боковой панели (сайдбара) сайта.
  ├── layouts
  │ └── base.html
  │ - Базовый шаблон: Основной шаблон для всех страниц сайта, содержит общие элементы (шапка, подвал, скрипты, стили).
  ├── registration
  │ ├── login.html
  │ - Форма входа (альтернативная): Альтернативная страница для входа пользователей.
  │ ├── password_change_done.html
  │ - Уведомление об успешной смене пароля (альтернативное): Альтернативная страница уведомления об успешной смене
  пароля.
  │ ├── password_change_form.html
  │ - Форма смены пароля (альтернативная): Альтернативная страница для смены пароля.
  │ ├── password_reset_complete.html
  │ - Уведомление об успешном сбросе пароля (альтернативное): Альтернативная страница уведомления об успешном сбросе
  пароля.
  │ ├── password_reset_confirm.html
  │ - Форма подтверждения сброса пароля (альтернативная): Альтернативная страница для подтверждения сброса пароля.
  │ ├── password_reset_done.html
  │ - Уведомление об отправке инструкции по сбросу пароля (альтернативное): Альтернативная страница уведомления об
  отправке инструкции по сбросу пароля.
  │ ├── password_reset_form.html
  │ - Форма запроса на сброс пароля (альтернативная): Альтернативная страница для запроса сброса пароля.
  │ └── register.html
  │ - Форма регистрации (альтернативная): Альтернативная страница для регистрации нового пользователя.
  └── sitemap.xml
    - Карта сайта: XML-файл, содержащий список всех страниц сайта для поисковых систем.


## URL-адреса панели управления (dashboard) - текстовое описание

Этот раздел описывает URL-адреса, определенные в файле `dashboard/urls.py`, в текстовом формате, поясняя назначение каждого маршрута.

-   `/`: Главная страница панели управления.
-   `/instructions`: Страница с инструкциями для пользователей.
-   `/brigades/`: Список всех бригад.
-   `/brigade/<int:pk>/detail`: Подробная информация о бригаде с ID `<pk>`.
-   `/brigades/create/`: Форма для создания новой бригады.
-   `/brigades/<int:pk>/update/`: Форма для обновления бригады с ID `<pk>`.
-   `/brigades/<int:brigade_id>/delete/`: Запрос на удаление бригады с ID `<brigade_id>`.
-   `/categories/`: Список всех категорий.
-   `/categories/create/`: Форма для создания новой категории.
-   `/categories/<int:pk>/update/`: Форма для обновления категории с ID `<pk>`.
-   `/categories/<int:category_id>/delete/`: Запрос на удаление категории с ID `<category_id>`.
-   `/equipment/`: Список всего оборудования.
-   `/equipment/create/`: Форма для создания новой единицы оборудования.
-   `/equipment/<int:brigade_id>/create/`: Форма для создания оборудования, привязанного к бригаде с ID `<brigade_id>`.
-   `/equipment/<int:equipment_id>/<int:brigade_id>/add_document/`: Страница для добавления документов к оборудованию с ID `<equipment_id>` привязанному к бригаде с ID `<brigade_id>`.
-   `/equipment/<int:pk>/update/`: Форма для обновления оборудования с ID `<pk>`.
-   `/equipment/<int:pk>/<int:brigade_id>/update_by_brigade/`: Форма для обновления оборудования с ID `<pk>`, привязанного к бригаде с ID `<brigade_id>`.
-   `/equipment/<int:equipment_id>/delete/`: Запрос на удаление оборудования с ID `<equipment_id>`.
-   `/equipment/<int:pk>/`: Подробная информация об оборудовании с ID `<pk>`.
-   `/transfers/history/`: История перемещений оборудования.
-   `/users/`: Список всех пользователей.
-   `/users/create/`: Форма для создания нового пользователя.
-   `/users/<int:pk>/update/`: Форма для обновления пользователя с ID `<pk>`.
-   `/user/<int:pk>/update/`: Форма для обновления аккаунта пользователя с ID `<pk>`.
-   `/users/<int:user_id>/delete/`: Запрос на удаление пользователя с ID `<user_id>`.
-    `/user/<int:pk>/detail`: Детальная информация о пользователе с ID `<pk>`.
-   `/action-log/`: Журнал действий пользователей.
-   `/reports/`: Список доступных отчетов.
-   `/reports/summary/`: Сводный отчет.
-   `/reports/brigades/`: Отчеты по бригадам.
-   `/brigade/export/csv/`: Скачивание данных о бригадах в формате CSV.
-   `/brigade/export/excel/`: Скачивание данных о бригадах в формате Excel.
-   `/equipment/export/csv/`: Скачивание данных об оборудовании в формате CSV.
-   `/equipment/export/excel/`: Скачивание данных об оборудовании в формате Excel.


## Примечания

* 'id' в URL означает идентификатор (например, ID бригады, оборудования, пользователя).
* Структура URL может отличаться в зависимости от выбранного URL routing.
* Описанные страницы могут включать дополнительные элементы и функциональность, не описанные здесь.
